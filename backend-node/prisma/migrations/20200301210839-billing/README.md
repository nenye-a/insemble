# Migration `20200301210839-billing`

This migration has been generated by Simon at 3/1/2020, 9:08:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."SubscriptionTenantHistory" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "subscriptionId" text  NOT NULL DEFAULT '',
    "tenantUser" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."TenantUser" ADD COLUMN "stripeCustomerId" text   ,
ADD COLUMN "stripeSubscriptionId" text   ;

ALTER TABLE "public"."LandlordUser" ADD COLUMN "stripeCustomerId" text   ,
ADD COLUMN "stripeSubscriptionId" text   ;

CREATE UNIQUE INDEX "TenantUser.stripeCustomerId" ON "public"."TenantUser"("stripeCustomerId")

CREATE UNIQUE INDEX "TenantUser.stripeSubscriptionId" ON "public"."TenantUser"("stripeSubscriptionId")

CREATE UNIQUE INDEX "LandlordUser.stripeCustomerId" ON "public"."LandlordUser"("stripeCustomerId")

CREATE UNIQUE INDEX "LandlordUser.stripeSubscriptionId" ON "public"."LandlordUser"("stripeSubscriptionId")

ALTER TABLE "public"."SubscriptionTenantHistory" ADD FOREIGN KEY ("tenantUser") REFERENCES "public"."TenantUser"("id") ON DELETE RESTRICT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200228131611-add-landlord-register-verification..20200301210839-billing
--- datamodel.dml
+++ datamodel.dml
@@ -1,29 +1,38 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = "postgresql://prisma:prisma@localhost:5432/insemble?schema=public"
 }
 generator client {
   provider = "prisma-client-js"
 }
 enum TenantTier {
-  FREE EXPLORE SMART PROFESSIONAL
+  FREE
+  EXPLORE
+  SMART
+  PROFESSIONAL
 }
 enum LandlordTier {
-  FREE EXPLORE SMART PROFESSIONAL
+  FREE
+  EXPLORE
+  SMART
+  PROFESSIONAL
 }
 enum NewLocationPlan {
-  YES NOT_ACTIVE NOT_PLANNING
+  YES
+  NOT_ACTIVE
+  NOT_PLANNING
 }
 enum MarketingPreference {
-  PUBLIC PRIVATE
+  PUBLIC
+  PRIVATE
 }
 model MatchingProperty {
   id         String @id @default(cuid())
@@ -49,35 +58,40 @@
   estimate     String
 }
 model TenantUser {
-  id           String     @id @default(cuid())
-  email        String     @unique
-  avatar       String?
-  password     String
-  firstName    String
-  lastName     String
-  company      String
-  phoneNumber  String?
-  title        String?
-  description  String?
-  brands       Brand[]
-  tier         TenantTier
-  pendingEmail Boolean    @default(false)
+  id                   String     @id @default(cuid())
+  email                String     @unique
+  avatar               String?
+  password             String
+  firstName            String
+  lastName             String
+  company              String
+  phoneNumber          String?
+  title                String?
+  description          String?
+  brands               Brand[]
+  tier                 TenantTier
+  pendingEmail         Boolean    @default(false)
+  stripeCustomerId     String?    @unique
+  stripeSubscriptionId String?    @unique
 }
 model LandlordUser {
-  id          String       @id @default(cuid())
-  email       String       @unique
-  avatar      String?
-  password    String
-  firstName   String
-  lastName    String
-  company     String
-  phoneNumber String?
-  title       String?
-  description String?
-  tier        LandlordTier
+  id                   String       @id @default(cuid())
+  email                String       @unique
+  avatar               String?
+  password             String
+  firstName            String
+  lastName             String
+  company              String
+  phoneNumber          String?
+  title                String?
+  description          String?
+  properties           Property[]
+  tier                 LandlordTier
+  stripeCustomerId     String?      @unique
+  stripeSubscriptionId String?      @unique
 }
 model Brand {
   id                     String                   @id @default(cuid())
@@ -168,8 +182,15 @@
   landlordInput String
   verified      Boolean @default(false)
 }
+model SubscriptionTenantHistory {
+  id             String     @default(cuid()) @id
+  subscriptionId String
+  tenantUser     TenantUser
+  createdAt      DateTime   @default(now())
+}
+
 model TenantRegisterVerification {
   id            String  @default(cuid()) @id
   businessInput String?
   tenantInput   String
@@ -182,5 +203,5 @@
   id       String     @default(cuid()) @id
   email    String
   user     TenantUser
   verified Boolean    @default(false)
-}
+}
```


