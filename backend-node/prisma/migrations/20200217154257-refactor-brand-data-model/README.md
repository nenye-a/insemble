# Migration `20200217154257-refactor-brand-data-model`

This migration has been generated by RaymondAnggara at 2/17/2020, 3:42:57 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."MatchingProperty" (
    "address" text  NOT NULL DEFAULT '',
    "brand" text   ,
    "id" text  NOT NULL ,
    "propertyId" text  NOT NULL DEFAULT '',
    "rent" integer  NOT NULL DEFAULT 0,
    "sqft" integer  NOT NULL DEFAULT 0,
    "type" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."Location" DROP COLUMN "name",
ADD COLUMN "address" text  NOT NULL DEFAULT '';

ALTER TABLE "public"."Brand" ADD COLUMN "matchingLocations" text   ,
ADD COLUMN "maxRent" integer   ,
ADD COLUMN "minRent" integer   ,
ALTER COLUMN "location" DROP NOT NULL,
ALTER COLUMN "locationCount" DROP NOT NULL,
ALTER COLUMN "locationCount" DROP DEFAULT,
ALTER COLUMN "maxAge" DROP NOT NULL,
ALTER COLUMN "maxAge" DROP DEFAULT,
ALTER COLUMN "maxIncome" DROP NOT NULL,
ALTER COLUMN "maxIncome" DROP DEFAULT,
ALTER COLUMN "maxSize" DROP NOT NULL,
ALTER COLUMN "maxSize" DROP DEFAULT,
ALTER COLUMN "minAge" DROP NOT NULL,
ALTER COLUMN "minAge" DROP DEFAULT,
ALTER COLUMN "minIncome" DROP NOT NULL,
ALTER COLUMN "minIncome" DROP DEFAULT,
ALTER COLUMN "minSize" DROP NOT NULL,
ALTER COLUMN "minSize" DROP DEFAULT,
ALTER COLUMN "name" DROP NOT NULL,
ALTER COLUMN "name" DROP DEFAULT,
ALTER COLUMN "newLocationPlan" DROP NOT NULL,
ALTER COLUMN "newLocationPlan" DROP DEFAULT,
ALTER COLUMN "userRelation" DROP NOT NULL,
ALTER COLUMN "userRelation" DROP DEFAULT;

ALTER TABLE "public"."MatchingProperty" ADD FOREIGN KEY ("brand") REFERENCES "public"."Brand"("id") ON DELETE SET NULL

ALTER TABLE "public"."Brand" ADD FOREIGN KEY ("location") REFERENCES "public"."Location"("id") ON DELETE SET NULL
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200214154847-add-tenant-session..20200217154257-refactor-brand-data-model
--- datamodel.dml
+++ datamodel.dml
@@ -1,8 +1,8 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = "postgresql://prisma:prisma@localhost:5432/insemble?schema=public"
 }
 generator client {
@@ -21,13 +21,29 @@
   NOT_ACTIVE
   NOT_PLANNING
 }
+// model MatchingLocation {
+//   id    String @id
+//   lat   Float
+//   lng   Float
+//   match Float
+// }
+
+model MatchingProperty {
+  id         String @id @default(cuid())
+  propertyId String
+  address    String
+  rent       Int
+  sqft       Int
+  type       String
+}
+
 model Location {
-  id   String @id @default(cuid())
-  name String
-  lat  String
-  lng  String
+  id      String @id @default(cuid())
+  address String
+  lat     String
+  lng     String
 }
 model LocationAndPerformance {
   id           String @id @default(cuid())
@@ -54,35 +70,39 @@
 model Brand {
   id                     String                   @id @default(cuid())
   // Note: All field can be empty because some case
   // Brand description
-  name                   String
-  location               Location                 @relation(name: "currentLocation")
+  name                   String?
+  location               Location?                @relation(name: "currentLocation")
   categories             String[]
   // Also for filter and description
-  userRelation           String
+  userRelation           String?
   // Goal of this brand
-  newLocationPlan        NewLocationPlan
+  newLocationPlan        NewLocationPlan?
   nextLocations          Location[]               @relation(name: "nextLocation")
-  locationCount          Int
+  locationCount          Int?
   // Filter params for heatmap
-  minAge                 Int
-  maxAge                 Int
-  minIncome              Int
-  maxIncome              Int
+  minAge                 Int?
+  maxAge                 Int?
+  minIncome              Int?
+  maxIncome              Int?
+  minRent                Int?
+  maxRent                Int?
   personas               String[]
   education              String[]
   commute                String[]
-  minSize                Int
-  maxSize                Int
+  minSize                Int?
+  maxSize                Int?
   equipmentIds           String[]
   spaceType              String[]
   locationAndPerformance LocationAndPerformance[]
+  matchingLocations      String?
+  matchingProperies      MatchingProperty[]
   createdAt              DateTime                 @default(now())
 }
 model TenantSession {
   id        String     @default(cuid()) @id
   token     String
   createdAt DateTime   @default(now())
   user      TenantUser
-}
+}
```


