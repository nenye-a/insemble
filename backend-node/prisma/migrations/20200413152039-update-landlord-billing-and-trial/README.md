# Migration `20200413152039-update-landlord-billing-and-trial`

This migration has been generated by RaymondAnggara at 4/13/2020, 3:20:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."LandlordUser.stripeSubscriptionId"

CREATE TABLE "public"."SubscriptionLandlordHistory" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "landlordUser" text  NOT NULL ,
    "subscriptionId" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."TenantUser" ADD COLUMN "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00';

ALTER TABLE "public"."LandlordUser" DROP COLUMN "stripeSubscriptionId",
DROP COLUMN "tier",
ADD COLUMN "billingAnchor" integer   ,
ADD COLUMN "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00';

ALTER TABLE "public"."Space" ADD COLUMN "stripeSubscriptionId" text   ,
ADD COLUMN "tier" text  NOT NULL DEFAULT 'NO_TIER';

CREATE UNIQUE INDEX "Space.stripeSubscriptionId" ON "public"."Space"("stripeSubscriptionId")

ALTER TABLE "public"."SubscriptionLandlordHistory" ADD FOREIGN KEY ("landlordUser") REFERENCES "public"."LandlordUser"("id") ON DELETE RESTRICT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200406141204-space-type-and-preference-adjust..20200413152039-update-landlord-billing-and-trial
--- datamodel.dml
+++ datamodel.dml
@@ -1,8 +1,8 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = "postgresql://prisma:prisma@localhost:5432/insemble?schema=public"
 }
 generator client {
@@ -10,17 +10,14 @@
 }
 enum TenantTier {
   FREE
-  EXPLORE
-  SMART
   PROFESSIONAL
 }
 enum LandlordTier {
-  FREE
-  EXPLORE
-  SMART
+  NO_TIER
+  BASIC
   PROFESSIONAL
 }
 enum NewLocationPlan {
@@ -70,8 +67,9 @@
   tier                 TenantTier
   pendingEmail         Boolean         @default(false)
   stripeCustomerId     String?         @unique
   stripeSubscriptionId String?         @unique
+  createdAt            DateTime        @default(now())
 }
 model LandlordUser {
   id                   String       @id @default(cuid())
@@ -84,12 +82,12 @@
   phoneNumber          String?
   title                String?
   description          String?
   properties           Property[]
-  tier                 LandlordTier
+  billingAnchor        Int?
   pendingEmail         Boolean      @default(false)
   stripeCustomerId     String?      @unique
-  stripeSubscriptionId String?      @unique
+  createdAt            DateTime     @default(now())
 }
 model Brand {
   id                     String                   @id @default(cuid())
@@ -132,22 +130,24 @@
   createdAt              DateTime                 @default(now())
 }
 model Space {
-  id                  String   @id @default(cuid())
-  spaceId             String?  @unique
-  mainPhoto           String
-  photos              String[]
-  description         String
-  condition           String
-  sqft                Int
-  pricePerSqft        Int
-  equipment           String[]
-  marketingPreference MarketingPreference
-  spaceType           String[]
-  available           DateTime
-  matchingBrand       String?
-  createdAt           DateTime @default(now())
+  id                   String   @id @default(cuid())
+  spaceId              String?  @unique
+  mainPhoto            String
+  photos               String[]
+  description          String
+  condition            String
+  sqft                 Int
+  pricePerSqft         Int
+  equipment            String[]
+  marketingPreference  MarketingPreference
+  spaceType            String[]
+  available            DateTime
+  matchingBrand        String?
+  tier                 LandlordTier
+  stripeSubscriptionId String?  @unique
+  createdAt            DateTime @default(now())
 }
 model Property {
   id                  String              @id @default(cuid())
@@ -212,8 +212,15 @@
   tenantUser     TenantUser
   createdAt      DateTime   @default(now())
 }
+model SubscriptionLandlordHistory {
+  id             String     @default(cuid()) @id
+  subscriptionId String
+  landlordUser   LandlordUser
+  createdAt      DateTime   @default(now())
+}
+
 model TenantRegisterVerification {
   id            String  @default(cuid()) @id
   businessInput String?
   tenantInput   String
```


