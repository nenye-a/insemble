# Migration `20200214154847-add-tenant-session`

This migration has been generated by Joshua at 2/14/2020, 3:48:47 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."TenantSession" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "token" text  NOT NULL DEFAULT '',
    "user" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."Brand" DROP COLUMN "personaIds",
ADD COLUMN "commute" text []  ,
ADD COLUMN "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
ADD COLUMN "education" text []  ,
ADD COLUMN "location" text  NOT NULL ,
ADD COLUMN "personas" text []  ;

ALTER TABLE "public"."TenantSession" ADD FOREIGN KEY ("user") REFERENCES "public"."TenantUser"("id") ON DELETE RESTRICT

ALTER TABLE "public"."Brand" ADD FOREIGN KEY ("location") REFERENCES "public"."Location"("id") ON DELETE RESTRICT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200214115812-add-unique-email-constraint..20200214154847-add-tenant-session
--- datamodel.dml
+++ datamodel.dml
@@ -1,8 +1,8 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = "postgresql://prisma:prisma@localhost:5432/insemble?schema=public"
 }
 generator client {
@@ -21,16 +21,8 @@
   NOT_ACTIVE
   NOT_PLANNING
 }
-enum SpaceType {
-  FREE_STANDING
-  SHOPPING_CENTRE
-  INLINE
-  URBAN
-}
-
-
 model Location {
   id   String @id @default(cuid())
   name String
   lat  String
@@ -63,23 +55,34 @@
   id                     String                   @id @default(cuid())
   // Note: All field can be empty because some case
   // Brand description
   name                   String
+  location               Location                 @relation(name: "currentLocation")
   categories             String[]
   // Also for filter and description
   userRelation           String
   // Goal of this brand
   newLocationPlan        NewLocationPlan
-  locations              Location[]
+  nextLocations          Location[]               @relation(name: "nextLocation")
   locationCount          Int
   // Filter params for heatmap
   minAge                 Int
   maxAge                 Int
   minIncome              Int
   maxIncome              Int
-  personaIds             String[]
+  personas               String[]
+  education              String[]
+  commute                String[]
   minSize                Int
   maxSize                Int
   equipmentIds           String[]
-  spaceType              SpaceType[]
+  spaceType              String[]
   locationAndPerformance LocationAndPerformance[]
+  createdAt              DateTime                 @default(now())
+}
+
+model TenantSession {
+  id        String     @default(cuid()) @id
+  token     String
+  createdAt DateTime   @default(now())
+  user      TenantUser
 }
```


