# Migration `20200309145643-initial-message-model`

This migration has been generated by RaymondAnggara at 3/9/2020, 2:56:43 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Conversation" (
    "brand" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "header" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "landlord" text  NOT NULL ,
    "matchScore" integer  NOT NULL DEFAULT 0,
    "property" text  NOT NULL ,
    "tenant" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Message" (
    "conversation" text   ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "message" text  NOT NULL DEFAULT '',
    "sender" text  NOT NULL DEFAULT 'TENANT',
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."Conversation" ADD FOREIGN KEY ("tenant") REFERENCES "public"."TenantUser"("id") ON DELETE RESTRICT

ALTER TABLE "public"."Conversation" ADD FOREIGN KEY ("landlord") REFERENCES "public"."LandlordUser"("id") ON DELETE RESTRICT

ALTER TABLE "public"."Conversation" ADD FOREIGN KEY ("brand") REFERENCES "public"."Brand"("id") ON DELETE RESTRICT

ALTER TABLE "public"."Conversation" ADD FOREIGN KEY ("property") REFERENCES "public"."Property"("id") ON DELETE RESTRICT

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("conversation") REFERENCES "public"."Conversation"("id") ON DELETE SET NULL
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200306133154-add-security-token..20200309145643-initial-message-model
--- datamodel.dml
+++ datamodel.dml
@@ -1,8 +1,8 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = "postgresql://prisma:prisma@localhost:5432/insemble?schema=public"
 }
 generator client {
@@ -33,8 +33,13 @@
   PUBLIC
   PRIVATE
 }
+enum MessageRole {
+  TENANT
+  LANDLORD
+}
+
 model MatchingProperty {
   id         String @id @default(cuid())
   propertyId String
   address    String
@@ -236,4 +241,22 @@
   verified   Boolean      @default(false)
   tokenEmail String
   tokenQuery String
 }
+model Conversation {
+  id          String       @default(cuid()) @id
+  tenant      TenantUser
+  landlord    LandlordUser
+  messages    Message[]
+  brand       Brand
+  property    Property
+  matchScore  Int
+  header      String
+  createdAt   DateTime     @default(now())
+}
+
+model Message {
+  id        String      @default(cuid()) @id
+  sender    MessageRole
+  message   String
+  createdAt DateTime    @default(now())
+}
```


