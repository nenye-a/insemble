# SW Precache Webpack Plugin
[![NPM version][npm-img]][npm-url]
[![NPM downloads][npm-downloads-img]][npm-url]
[![CircleCI][circleci-img]][circleci-url]

__`SWPrecacheWebpackPlugin`__ is a [webpack][webpack] plugin for using [service workers][sw-guide] to cache your external project dependencies. It will generate a service worker file using [sw-precache][sw-precache] and add it to your build directory.


## Install
```bash
npm install --save-dev sw-precache-webpack-plugin
```

## Basic Usage
A simple configuration example that will work well in most production environments. Based on the configuration used in [create-react-app].
```javascript
var path = require('path');
var SWPrecacheWebpackPlugin = require('sw-precache-webpack-plugin');

const PUBLIC_PATH = 'DELETED_URL_WITH_CREDENTIALS"app's"
        // bundled resources. This is one way to separate bundled assets for each
        // application.
        staticFileGlobs: [
          `${OUTPUT_DIR}/js/manifest.*.js`,
          `${OUTPUT_DIR}/js/${app}.*.js`,
          `${OUTPUT_DIR}/css/${app}.*.css`,
          `${OUTPUT_DIR}/${app}.html`,
        ],
      })),
  ],
}
```

### `importScripts` usage example

Accepts an array of `<String|Object>`'s. `String` entries are legacy supported. Use `filename` instead.

If `importScripts` item is object, there are 2 possible properties to set on this object:
- **filename**: Use this if you are referencing a path that "you just know" exists. You probably don't want to use this for named chunks.
- **chunkName**: Supports named entry chunks & dynamically imported named chunks.
```javascript
entry: {
  main: __dirname + '/src/index.js',
  sw: __dirname + '/src/service-worker-entry.js'
},
output: {
  publicPath: '/my/public/path',
  chunkfileName: '[name].[<hash|chunkhash>].js'
},
plugins: [
  new SWPrecacheWebpackPlugin({
    filename: 'my-project-service-worker.js',
    importScripts: [
      // * legacy supported
      // [chunkhash] is not supported for this usage
      // This is transformed to new object syntax:
      // { filename: '/my/public/path/some-known-script-path.js' }
      'some-known-script-path.js',

      // This use case is identical to above, except
      // for excluding the .[hash] part:
      { filename: 'some-known-script-path.[hash].js' },

      // When [chunkhash] is specified in filename:
      // - filename must match the format specified in output.chunkfileName
      // - If chunkName is invalid; an error will be reported
      { chunkName: 'sw' },

      // Works for named entry chunks & dynamically imported named chunks:
      // For ex, if in your code is:
      // import(/* webpackChunkName: "my-named-chunk" */ './my-async-script.js');
      { chunkName: 'my-named-chunk' },

      // All importScripts entries resolve to a string, therefore
      // the final output of the above input is:
      // [
      //   '/my/public/path/some-known-script-path.js',
      //   '/my/public/path/some-known-script-path.<compilation hash>.js',
      //   '/my/public/path/some-known-script-path.<chunkhash>.js',
      //   '/my/public/path/<id>.my-named-chunk.<chunkhash>.js'
      // ]
    ]
  }),
]
```

## Webpack Dev Server Support
Currently `SWPrecacheWebpackPlugin` will not work with `Webpack Dev Server`. If you wish to test the service worker locally, you can use simple a node server [see example project][example-project] or `python SimpleHTTPServer` from your build directory. I would suggest pointing your node server to a different port than your usual local development port and keeping the precache service worker out of your [local configuration (example)][webpack-local-config-example]. 

Or add `setup` section to `devServer` config, e.g.:
```
module.exports = {
    devServer: {
        setup: function (app) {
            app.get('/service-worker.js', function (req, res) {
                res.set({ 'Content-Type': 'application/javascript; charset=utf-8' });
                res.send(fs.readFileSync('build/service-worker.js'));
            });
        }
    }
}
```

There will likely never be `webpack-dev-server` support. `sw-precache` needs physical files in order to generate the service worker. Webpack-dev-server files are in-memory. It is only possible to provide `sw-precache` with globs to find these files. It will follow the glob pattern and generate a list of file names to cache.


## Contributing
Install node dependencies:
```
  $ npm install
```

Or:
```
  $ yarn
```

Add unit tests for your new feature in `./test/plugin.spec.js`

## Testing
Tests are located in `./test`

Run tests:
```
  $ npm t
```

<!--references-->
[sw-guide]: https://github.DELETED_BASE64_STRING_workers.md "Introduction to service workers"
[sw-precache]: https://github.com/GoogleChrome/sw-precache "SW-Precache"
[sw-precache-options]: https://github.com/GoogleChrome/sw-precache#options-parameter "SW-Precache Options"
[sw-precache-registration-example]: https://github.com/GoogleChrome/sw-precache/blob/DELETED_LONG_HEX_STRING/demo/app/js/service-worker-registration.js
[example-project]: /examples/
[webpack]: http://webpack.js.org/
[webpack-local-config-example]: https://github.com/goldhand/cookiecutter-webpack/blob/DELETED_LONG_HEX_STRING/%7B%7Bcookiecutter.repo_name%7D%7D/webpack.local.config.js "Webpack local config example"
[create-react-app]: https://github.com/facebookincubator/create-react-app/blob/DELETED_LONG_HEX_STRING/packages/react-scripts/config/webpack.config.prod.js#L308

[npm-url]: https://npmjs.org/package/sw-precache-webpack-plugin
[npm-img]: https://badge.fury.io/js/sw-precache-webpack-plugin.svg
[npm-downloads-img]: https://img.shields.io/npm/dm/sw-precache-webpack-plugin.svg?style=flat-square
[daviddm-img]: https://david-dm.org/goldhand/sw-precache-webpack-plugin.svg
[daviddm-url]: https://david-dm.org/goldhand/sw-precache-webpack-plugin
[circleci-img]: https://circleci.com/gh/goldhand/sw-precache-webpack-plugin.svg?style=svg
[circleci-url]: https://circleci.com/gh/goldhand/sw-precache-webpack-plugin
