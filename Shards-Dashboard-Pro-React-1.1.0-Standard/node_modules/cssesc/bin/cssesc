#!/usr/bin/env node
(function() {

	var fs = require('fs');
	var cssesc = require('../cssesc.js');
	var strings = process.argv.splice(2);
	var stdin = process.stdin;
	var data;
	var timeout;
	var isObject = false;
	var options = {};
	var log = console.log;

	var main = function() {
		var option = strings[0];

		if (/^(?:-h|--help|undefined)$/.test(option)) {
			log(
				'cssesc v%s - http://mths.be/cssesc',
				cssesc.version
			);
			log([
				'\nUsage:\n',
				'\tcssesc [string]',
				'\tcssesc [-i | --identifier] [string]',
				'\tcssesc [-s | --single-quotes] [string]',
				'\tcssesc [-d | --double-quotes] [string]',
				'\tcssesc [-w | --wrap] [string]',
				'\tcssesc [-e | --escape-everything] [string]',
				'\tcssesc [-v | --version]',
				'\tcssesc [-h | --help]',
				'\nExamples:\n',
				'\tcssesc \'f\xF6o \u2665 b\xE5r \uD834\uDF06 baz\'',
				'\tcssesc --identifier \'f\xF6o \u2665 b\xE5r \uD834\uDF06 baz\'',
				'\tcssesc --escape-everything \'f\xF6o \u2665 b\xE5r \uD834\uDF06 baz\'',
				'\tcssesc --double-quotes --wrap \'f\xF6o \u2665 b\xE5r \uD834\uDF06 baz\'',
				'\techo \'f\xF6o \u2665 b\xE5r \uD834\uDF06 baz\' | cssesc'
			].join('\n'));
			return process.exit(1);
		}

		if (/^(?:-v|--version)$/.test(option)) {
			log('v%s', cssesc.version);
			return process.exit(1);
		}

		strings.forEach(function(string) {
			// Process options
			if (/^(?:-i|--identifier)$/.test(string)) {
				options.isIdentifier = true;
				return;
			}
			if (/^(?:-s|--single-quotes)$/.test(string)) {
				options.quotes = 'single';
				return;
			}
			if (/^(?:-d|--double-quotes)$/.test(string)) {
				options.quotes = 'double';
				return;
			}
			if (/^(?:-w|--wrap)$/.test(string)) {
				options.wrap = true;
				return;
			}
			if (/^(?:-e|--escape-everything)$/.test(string)) {
				options.escapeEverything = true;
				return;
			}

			// Process string(s)
			var result;
			try {
				result = cssesc(string, options);
				log(result);
			} catch(error) {
				log(error.message + '\n');
				log('Error: failed to escape.');
				log('If you think this is a bug in cssesc, please report it:');
				log('DELETED_URL_WITH_CREDENTIALS