# cacache [![npm version](DELETED_URL_WITH_CREDENTIALS"put-options"></a> `> opciones para cacache.mete`

La funciones `cacache.mete` tienen un n√∫mero de opciones en com√∫n.

##### `ops.metadata`

Metadatos del usuario que se almacenar√°n con la entrada.

##### `ops.size`

El tama√±o declarado de los datos que se van a insertar. Si es prove√≠do, cacache
verificar√° que los datos escritos sean de ese tama√±o, o si no, fallar√° con un
error con c√≥digo `EBADSIZE`.

##### `ops.integrity`

El hacheo de integridad de los datos siendo escritos.

Si es prove√≠do, y los datos escritos no le corresponden, la operaci√≥n fallar√°
con un error con c√≥digo `EINTEGRITY`.

`ops.algorithms` no tiene ning√∫n efecto si esta opci√≥n est√° presente.

##### `ops.algorithms`

Por Defecto: `['sha512']`

Algoritmos que se deben usar cuando se calcule el hacheo de [subresource
integrity](#integrity) para los datos insertados. Puede usar cualquier algoritmo
enumerado en `crypto.getHashes()`.

Por el momento, s√≥lo se acepta un algoritmo (d√≠gase, un array con ex√°ctamente un
valor). No tiene ning√∫n efecto si `ops.integrity` tambi√©n ha sido proveido.

##### `ops.uid`/`ops.gid`

Si est√°n presentes, cacache har√° todo lo posible para asegurarse que todos los
ficheros creados en el proceso de sus operaciones en el cach√© usen esta
combinaci√≥n en particular.

##### `ops.memoize`

Por Defecto: `null`

Si es verdad, cacache tratar√° de memoizar los datos de la entrada en memoria. La
pr√≥xima vez que el proceso corriente trate de accesar los datos o entrada,
cacache buscar√° en memoria antes de buscar en disco.

Si `ops.memoize` es un objeto regular o un objeto como `Map` (es decir, un
objeto con m√©todos `get()` y `set()`), este objeto en s√≠ sera usado en vez del
cach√© de memoria global. Esto permite tener l√≥gica espec√≠fica a tu aplicaci√≥n
encuanto al almacenaje en memoria de tus datos.

Si quieres asegurarte que los datos se lean del disco en vez de memoria, usa
`memoize: false` cuando uses funciones de `cacache.saca`.

#### <a name="rm-all"></a> `> cacache.rm.todo(cache) -> Promise`

Borra el cach√© completo, incluyendo ficheros temporeros, ficheros de datos, y el
√≠ndice del cach√©.

##### Ejemplo

```javascript
cacache.rm.todo(rutaCache).then(() => {
  console.log('THE APOCALYPSE IS UPON US üò±')
})
```

#### <a name="rm-entry"></a> `> cacache.rm.entrada(cache, clave) -> Promise`

Alias: `cacache.rm`

Borra la entrada `clave` del √≠nduce. El contenido asociado con esta entrada
seguir√° siendo accesible por hacheo usando
[`saca.flujo.porHacheo`](#get-stream).

Para borrar el contenido en s√≠, usa [`rm.datos`](#rm-content). Si quieres hacer
esto de manera m√°s segura (pues ficheros de contenido pueden ser usados por
multiples entradas), usa [`verifica`](#verify) para borrar hu√©rfanos.

##### Ejemplo

```javascript
cacache.rm.entrada(rutaCache, 'my-thing').then(() => {
  console.log('I did not like it anyway')
})
```

#### <a name="rm-content"></a> `> cacache.rm.datos(cache, integrity) -> Promise`

Borra el contenido identificado por `integrity`. Cualquier entrada que se
refiera a este contenido quedar√°n hu√©rfanas y se invalidar√°n si se tratan de
accesar, al menos que contenido id√©ntico sea a√±adido bajo `integrity`.

##### Ejemplo

```javascript
cacache.rm.datos(rutaCache, 'sha512-SoMeDIGest/IN+BaSE64==').then(() => {
  console.log('los datos para `mi-cosa` se borraron')
})
```

#### <a name="set-locale"></a> `> cacache.ponLenguaje(locale)`

Configura el lenguaje usado para mensajes y errores de cacache. La lista de
lenguajes disponibles est√° en el directorio `./locales` del proyecto.

_Te interesa a√±adir m√°s lenguajes? [Somete un PR](CONTRIBUTING.md)!_

#### <a name="clear-memoized"></a> `> cacache.limpiaMemoizado()`

Completamente reinicializa el cach√© de memoria interno. Si est√°s usando tu
propio objecto con `ops.memoize`, debes hacer esto de manera espec√≠fica a √©l.

#### <a name="tmp-mkdir"></a> `> tmp.hazdir(cache, ops) -> Promise<Path>`

Alias: `tmp.mkdir`

Devuelve un directorio √∫nico dentro del directorio `tmp` del cach√©.

Una vez tengas el directorio, es responsabilidad tuya asegurarte que todos los
ficheros escrito a √©l sean creados usando los permisos y `uid`/`gid` concordante
con el cach√©. Si no, puedes pedirle a cacache que lo haga llamando a
[`cacache.tmp.fix()`](#tmp-fix). Esta funci√≥n arreglar√° todos los permisos en el
directorio tmp.

Si quieres que cacache limpie el directorio autom√°ticamente cuando termines, usa
[`cacache.tmp.conTmp()`](#with-tpm).

##### Ejemplo

```javascript
cacache.tmp.mkdir(cache).then(dir => {
  fs.writeFile(path.join(dir, 'blablabla'), Buffer#<1234>, ...)
})
```

#### <a name="with-tmp"></a> `> tmp.conTmp(cache, ops, cb) -> Promise`

Crea un directorio temporero con [`tmp.mkdir()`](#tmp-mkdir) y ejecuta `cb` con
√©l como primer argumento. El directorio creado ser√° removido autom√°ticamente
cuando el valor devolvido por `cb()` se resuelva.

Las mismas advertencias aplican en cuanto a manejando permisos para los ficheros
dentro del directorio.

##### Ejemplo

```javascript
cacache.tmp.conTmp(cache, dir => {
  return fs.writeFileAsync(path.join(dir, 'blablabla'), Buffer#<1234>, ...)
}).then(() => {
  // `dir` no longer exists
})
```

#### <a name="integrity"></a> Hacheos de Subresource Integrity

cacache usa strings que siguen la especificaci√≥n de [Subresource Integrity
spec](https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity).

Es decir, donde quiera cacache espera un argumento o opci√≥n `integrity`, ese
string deber√≠a usar el formato `<algoritmo>-<hacheo-base64>`.

Una variaci√≥n importante sobre los hacheos que cacache acepta es que acepta el
nombre de cualquier algoritmo aceptado por el proceso de Node.js donde se usa.
Puedes usar `crypto.getHashes()` para ver cuales est√°n disponibles.

##### Generando tus propios hacheos

Si tienes un `shasum`, en general va a estar en formato de string hexadecimal
(es decir, un `sha1` se ver√≠a como algo as√≠:
`DELETED_LONG_HEX_STRING`).

Para ser compatible con cacache, necesitas convertir esto a su equivalente en
subresource integrity. Por ejemplo, el hacheo correspondiente al ejemplo
anterior ser√≠a: `sha1-X1UT+IIv2+UUWvM7ZNjZcNz5XG4=`.

Puedes usar c√≥digo as√≠ para generarlo por tu cuenta:

```javascript
const crypto = require('crypto')
const algoritmo = 'sha512'
const datos = 'foobarbaz'

const integrity = (
  algorithm +
  '-' +
  crypto.createHash(algoritmo).update(datos).digest('base64')
)
```

Tambi√©n puedes usar [`ssri`](https://npm.im/ssri) para deferir el trabajo a otra
librer√≠a que garantiza que todo est√© correcto, pues maneja probablemente todas
las operaciones que tendr√≠as que hacer con SRIs, incluyendo convirtiendo entre
hexadecimal y el formato SRI.

#### <a name="verify"></a> `> cacache.verifica(cache, ops) -> Promise`

Examina y arregla tu cach√©:

* Limpia entradas inv√°lidas, hu√©rfanas y corrompidas
* Te deja filtrar cuales entradas retener, con tu propio filtro
* Reclama cualquier ficheros de contenido sin referencias en el √≠ndice
* Verifica integridad de todos los ficheros de contenido y remueve los malos
* Arregla permisos del cach√©
* Remieve el directorio `tmp` en el cach√©, y todo su contenido.

Cuando termine, devuelve un objeto con varias estad√≠sticas sobre el proceso de
verificaci√≥n, por ejemplo la cantidad de espacio de disco reclamado, el n√∫mero
de entradas v√°lidas, n√∫mero de entradas removidas, etc.

##### Opciones

* `ops.uid` - uid para asignarle al cach√© y su contenido
* `ops.gid` - gid para asignarle al cach√© y su contenido
* `ops.filter` - recibe una entrada como argumento. Devuelve falso para removerla. Nota: es posible que esta funci√≥n sea invocada con la misma entrada m√°s de una vez.

##### Example

```sh
echo somegarbage >> $RUTACACHE/content/deadbeef
```

```javascript
cacache.verifica(rutaCache).then(stats => {
  // deadbeef collected, because of invalid checksum.
  console.log('cache is much nicer now! stats:', stats)
})
```

#### <a name="verify-last-run"></a> `> cacache.verifica.ultimaVez(cache) -> Promise`

Alias: `√∫ltimaVez`

Devuelve un `Date` que representa la √∫ltima vez que `cacache.verifica` fue
ejecutada en `cache`.

##### Example

```javascript
cacache.verifica(rutaCache).then(() => {
  cacache.verifica.ultimaVez(rutaCache).then(√∫ltima => {
    console.log('La √∫ltima vez que se us√≥ cacache.verifica() fue ' + √∫ltima)
  })
})
```
