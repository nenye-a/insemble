'use strict';
/* global describe it */

var assert = require('assert');
var hash = require('../');

describe('Hmac', function() {
  describe('mixed test vector', function() {
    test({
      name: 'nist 1',
      key: '00010203 04050607 08090A0B 0C0D0E0F' +
           '10111213 14151617 18191A1B 1C1D1E1F 20212223 24252627' +
           '28292A2B 2C2D2E2F 30313233 34353637 38393A3B 3C3D3E3F',
      msg: 'Sample message for keylen=blocklen',
      res: 'DELETED_LONG_HEX_STRING'
    });
    test({
      name: 'nist 2',
      key: '00010203 04050607' +
           '08090A0B 0C0D0E0F 10111213 14151617 18191A1B 1C1D1E1F',
      msg: 'Sample message for keylen<blocklen',
      res: 'DELETED_LONG_HEX_STRING'
    });
    test({
      name: 'nist 3',
      key: '00010203' +
           '04050607 08090A0B 0C0D0E0F 10111213 14151617 18191A1B' +
           '1C1D1E1F 20212223 24252627 28292A2B 2C2D2E2F 30313233' +
           '34353637 38393A3B 3C3D3E3F 40414243 44454647 48494A4B' +
           '4C4D4E4F 50515253 54555657 58595A5B 5C5D5E5F 60616263',
      msg: 'Sample message for keylen=blocklen',
      res: 'DELETED_LONG_HEX_STRING'
    });
    test({
      name: 'nist 4',
      key: '00' +
           '01020304 05060708 090A0B0C 0D0E0F10 11121314 15161718' +
           '191A1B1C 1D1E1F20 21222324 25262728 292A2B2C 2D2E2F30',
      msg: 'Sample message for keylen<blocklen, with truncated tag',
      res: 'DELETED_LONG_HEX_STRING'
    });
    test({
      name: 'regression 1',
      key: 'DELETED_LONG_HEX_STRING',
      msg: 'DELETED_LONG_HEX_STRING',
      msgEnc: 'hex',
      res: 'DELETED_LONG_HEX_STRING'
    });

    function test(opt) {
      it('should not fail at ' + opt.name, function() {
        var h = hash.hmac(hash.sha256, opt.key, 'hex');
        assert.equal(h.update(opt.msg, opt.msgEnc).digest('hex'), opt.res);
        h = hash.hmac(hash.sha256, opt.key, 'hex');
        assert.equal(h
          .update(opt.msg.slice(0, 10), opt.msgEnc)
          .update(opt.msg.slice(10), opt.msgEnc)
          .digest('hex'), opt.res);
      });
    }
  });
});
